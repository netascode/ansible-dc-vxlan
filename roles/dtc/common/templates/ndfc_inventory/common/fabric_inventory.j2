{# Auto-generated NDFC DC VXLAN EVPN Inventory config data structure for fabric {{ vxlan.fabric.name }} #}
{% set poap_data = poap_data['poap_data'] %}
{% for switch in MD_Extended.vxlan.topology.switches %}
{% if switch.management.management_ipv4_address is defined %}
- seed_ip: {{ switch['management']['management_ipv4_address'] }}
{% elif switch.management.management_ipv6_address is defined %}
- seed_ip: {{ switch['management']['management_ipv6_address'] }}
{% endif %}
{% macro get_auth_proto() %}
{%- if MD.vxlan.global.ebgp.auth_proto is defined -%}
{{ MD.vxlan.global.ebgp.auth_proto | default(defaults.vxlan.global.ebgp.auth_proto) }}
{%- elif MD.vxlan.global.ibgp.auth_proto is defined -%}
{{ MD.vxlan.global.ibgp.auth_proto | default(defaults.vxlan.global.ibgp.auth_proto) }}
{%- elif MD.vxlan.global.external.auth_proto is defined -%}
{{ MD.vxlan.global.external.auth_proto | default(defaults.vxlan.global.external.auth_proto) }}
{%- else -%}
{{ MD.vxlan.global.auth_proto | default(defaults.vxlan.global.auth_proto) }}
{%- endif -%}
{% endmacro %}
  auth_proto: {{ get_auth_proto() }}
  user_name: PLACE_HOLDER_USERNAME
  password: PLACE_HOLDER_PASSWORD
  max_hops: 0 # this is the default value as it is not defined into the data model
  role: {{ switch['role'] }}
  preserve_config: false
{# ------------------------------ #}
{# Global Bootstrap Section Start #}
{% if MD_Extended.vxlan.global.bootstrap is defined %}
{% if MD_Extended.vxlan.global.bootstrap.enable_bootstrap | default(defaults.vxlan.global.enable_bootstrap) | ansible.builtin.bool %}
{#     ------------------------- #}
{#     Switch POAP Section Start #}
{% if switch.poap is defined and (switch.poap.bootstrap | default(defaults.vxlan.topology.switches.poap.bootstrap) | ansible.builtin.bool) %}
{% if poap_data[switch['serial_number']] is defined %}
{% set pdata = poap_data[switch['serial_number']] %}
  poap:
    - serial_number: {{ switch['serial_number'] }}
      hostname: {{ switch['name'] }}
      model: {{ pdata['model'] }}
      version: {{ pdata['version'] }}
      config_data:
        modulesModel: {{ pdata['modulesModel'] }}
        gateway: {{ pdata['gateway'] }}
{% endif %}
{% endif %}
{#     ---------------------------------- #}
{#     Switch POAP Section End            #}
{##}
{#     ---------------------------------- #}
{#     Switch Pre-Provision Section Start #}
{% if switch['poap']['preprovision'] is defined %}
{% if switch['serial_number'] == switch['poap']['preprovision']['serial_number'] %}
  poap:
    - preprovision_serial: {{ switch['poap']['preprovision']['serial_number'] }}
      model: {{  switch['poap']['preprovision']['model'] }}
      version: {{ switch['poap']['preprovision']['version']  }}
      config_data:
        modulesModel: {{ switch['poap']['preprovision']['modulesModel'] }}
        gateway: {{ switch['management']['default_gateway_v4'] | ansible.utils.ipaddr('address') }}/{{ switch['management']['subnet_mask_ipv4'] }}
      hostname: {{ switch['name'] }}
{% else %}
  poap:
    - serial_number: {{ switch['serial_number'] }}
      preprovision_serial: {{ switch['poap']['preprovision']['serial_number'] }}
{% endif %}
{% endif %}
{#     Switch Pre-Provision Section End   #}
{#     ---------------------------------- #}
{% endif %}
{% endif %}
{# Global Bootstrap Section End #}
{# ---------------------------- #}
{% endfor %} 
