---
# This NDFC vPC Peering config data structure for vPC pairs is auto-generated
# DO NOT EDIT MANUALLY
#
{% if MD_Extended.vxlan.topology.vpc_peers is defined and MD_Extended.vxlan.topology.vpc_peers is not none %}
{% for vpc_peers_pair in MD_Extended.vxlan.topology.vpc_peers %}
- peerOneId: {{ vpc_peers_pair.peer1_mgmt_ip_address }}
  peerTwoId: {{ vpc_peers_pair.peer2_mgmt_ip_address }}
  templateName: "vpc_pair"
  profile:
    DOMAIN_ID: {{ vpc_peers_pair.domain_id }}
    FABRIC_NAME: {{ MD_Extended.vxlan.fabric.name }}
    KEEP_ALIVE_HOLD_TIMEOUT: {{ vpc_peers_pair.keepalive_holdout_time | default(defaults.vxlan.topology.vpc_peers.keepalive_holdout_time) }}
    KEEP_ALIVE_VRF: {{ vpc_peers_pair.keepalive_vrfname }}
    PEER1_DOMAIN_CONF: |2-
      {{ vpc_peers_pair.peer1_domain_conf | default('') | indent(6, false) }}
    PEER1_KEEP_ALIVE_LOCAL_IP: {{ vpc_peers_pair.peer1_keepalive_ipv4 }}
    PEER2_DOMAIN_CONF: |2-
      {{ vpc_peers_pair.peer2_domain_conf | default('') | indent(6, false)}}
    PEER2_KEEP_ALIVE_LOCAL_IP: {{ vpc_peers_pair.peer2_keepalive_ipv4 }}
{% set peer1_switch = MD_Extended.vxlan.topology.switches | selectattr('name', 'equalto', vpc_peers_pair.peer1) | first %}
{% set peer2_switch = MD_Extended.vxlan.topology.switches | selectattr('name', 'equalto', vpc_peers_pair.peer2) | first %}
{% if peer1_switch.interfaces is defined %}
{% set peer1_vpc_interface = peer1_switch.interfaces | selectattr('name', 'match', '^(port-channel|po)') | selectattr('mode', 'equalto', 'vpc_peer_link') | first | default({}) %}
{% endif %}
{% if peer2_switch.interfaces is defined %}
{% set peer2_vpc_interface = peer2_switch.interfaces | selectattr('name', 'match', '^(port-channel|po)') | selectattr('mode', 'equalto', 'vpc_peer_link') | first | default({}) %}
{% endif %}
{% if peer1_vpc_interface.name is defined %}
    PEER1_PO_CONF: |2-
      {{ peer1_vpc_interface.freeform_config | default('') | indent(6, false) }}
    PEER2_PO_CONF: |2-
      {{ peer2_vpc_interface.freeform_config | default('') | indent(6, false) }}
    PC_MODE: {{ peer1_vpc_interface.pc_mode | default(defaults.vxlan.topology.vpc_peers.port_channel_mode) }}
    PEER1_PO_DESC: "{{ peer1_vpc_interface.description | default('') }}"
    PEER2_PO_DESC: "{{ peer2_vpc_interface.description | default('') }}"
    PEER1_PCID: {{ peer1_vpc_interface.name | default('') | regex_replace('^(port-channel|po)', '') | default(defaults.vxlan.topology.vpc_peers.peer1_po_channel_id) }}
    PEER2_PCID: {{ peer2_vpc_interface.name | default('') | regex_replace('^(port-channel|po)', '') | default(defaults.vxlan.topology.vpc_peers.peer2_po_channel_id) }}
    PEER1_MEMBER_INTERFACES: "{{ peer1_vpc_interface.members | default([]) | join(',') }}"
    PEER2_MEMBER_INTERFACES: "{{ peer2_vpc_interface.members | default([]) | join(',') }}"
    ALLOWED_VLANS: "{{ peer1_vpc_interface.trunk_allowed_vlans | default(defaults.vxlan.topology.vpc_peers.trunk_allowed_vlans) }}"
    ADMIN_STATE: {{ peer1_vpc_interface.enabled }}
{% endif %}
{% endfor %}
{% endif %}
